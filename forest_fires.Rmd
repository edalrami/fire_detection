---
title: "Predicting Drought Code Using Weather & Meteorological Data"
author: "Darshil Desai, Edwin Ramirez"
date: "November 27, 2018"
output: 
  html_document:
    toc: true
    toc_float: true
    theme: united
---

# 2.1 Abstract

# 2.2 Introduction
Our project will focus on utilizing previous forest fire and weather data sourced from the UCI Machine Learning Repository to predict the Initial Spread Index (ISI) of fires in Portugal and any other countries using the Canadian Forest Wildfire Index System. We found this project to be of relevance considering the recent devastating droughts and fires in Northern Europe throughout Greece, Portugal, and Spain within the last year. Additionally, the relevance of the recent California fires also give support to the necessity of predictive analytics in this area. Hence, by utilizing a regressional model, we can predict the early behavior of a fire. Portugal utilizies the Canadian Forest Fire Weather Index System in order to track fuel moisture and wind to determine the intensity of a fire. Thus, by predicting the initial spread index of potential fires, we'd be able to predict the danger of a fire based on how quickly it would spread. The ISI scale begins at 0, where a 10 indicates a high rate of spread after ignition, and 16 or higher indicates an extreme rapid rate of spread.   

# 2.3 Dataset {.tabset}

## View Dataset

Lets take a look at the features in our dataset

Our dataset comprises of the following 13 variables: 

1 & 2. X,Y : coordinates within the Montesinho park. Ranges from 1 to 9 <br>
3. month: month when the fire frst occured <br>
4: day: day of the given month when the fire occured <br>
5: FFMC (Fine Fuel Moisture Code) : a numeric rating of the moisture content of litter and other cured fine fuels. This code is an indicator of the relative ease of ignition and the flammability of fine fuel. <br>
6: DMC (Duff Moisture Code): A numeric rating of the average moisture content of loosely compacted organic layers of moderate depth. This code gives an indication of fuel consumption in moderate duff layers and medium-size woody material.[^1] <br>
7.Burned area of the forest: area of forest burned  <br>
8. temperature <br>
9: RH (relative humidity) <br>
10: wind: wind speed <br>
11: rain <br>
12: DC (Drought Code):  A numeric rating of the average moisture content of deep, compact organic layers. This code is a useful indicator of seasonal drought effects on forest fuels and the amount of smoldering in deep duff layers and large logs. <br>

**8. ISI (Initial Spread Index): expected rate of fire spread** <br>

  This variable will be our response variable and we will try and establish a linear relationship between the myriad of weather and meterological factors of the forest experiencing fires and the future expected area burn. [^2]

``` {r see_data}
#reading in all the packages reqired for the report
library(ggcorrplot)
library(dplyr)
library(corrplot)
library(leaps)

#reading in the csv file
fire <- read.csv('forestfires.csv') 

```


```{r data_cleaning}
spring <- c('mar', 'apr', 'may')
summer <- c('jun', 'jul', 'aug')
autumn <- c('sep', 'oct','nov')
winter <- c('dec','jan', 'feb')

#clean data
#change month and day into numeric data
season = function(x){
  if(x %in% spring){
    return(1)
  } else if(x %in% summer){
    return(2)
  } else if(x %in% autumn){
    return(3)
  } else{
    return(4)
  }
}

week = function(x){
  if(x == 'mon'){
    return(1)
  } else if(x == 'tue'){
    return(2)
  } else if(x == 'wed'){
    return(3)
  } else if(x == 'thu'){
    return(4)
  } else if(x == 'fri'){
    return(5)
  } else if(x == 'sat'){
    return(6)
  } else{
    return(7)
  }
}

fire$month = sapply(fire$month, season)
fire$day = sapply(fire$day, week)
```


```{r}
#check correlation and distributions
library("psych")
pairs.panels(fire)
#check normality of response variable
hist(fire$ISI, col = "lightblue", xlab = "ISI", main = "Histogram of ISI")
```
As we can see from the histogram, the distribution of our data is right-skewed. Therefore, to solve this issue we transform the data, so that a normality violation won't affect the estimates of the standard error. We transform the data by taking the log of all our ISI data.  


```{r}
#transform data by taking log
trans = log(fire$ISI)
#Remove the below case or error occurs
trans[380] = 0
hist(trans, xlab = "Transformed ISI", col = "lightblue", main = "Histogram of ISI Transformed")
abline(v = mean(trans), col = 'red')
abline(v = median(trans), col = 'blue')
```

As we can see the distribution of ISI is now normal, and we can proceed with selecting the appropriate features for our model. A QQ-normal plot is shown below to illustrate that our data is normally distributed.  

```{r}
#use QQ plot check model
summary(lm(trans ~.-ISI, data = fire))
plot(lm(trans ~.-ISI, data = fire), 2)

```



```{r}
#stepwise regression
model = lm(trans ~.-ISI, data = fire)
new_model = step(model)
```

The QQ-normal plot below illustrates the distribution of our data after utilizing stepwise regression for feature selection. 
```{r}
#new model QQ plot
plot(new_model, 2)
summary(lm(trans ~ month + FFMC + DC + temp + RH + wind, data = fire))
```

However, stepwise doesn't remove all redundant features, and when we look closer at a summary of our model we can see that the p-value of `month` is above the significance of 0.05. So we can remove this feature from our model.

```{r}
summary(lm(trans ~ FFMC + temp + RH + wind, data = fire))
#displaying first 5 rows
```
 Once removed we can finally see the results of our model, where all p-values are considerably low. Therefore the best features for our model include `FFMC`, `temp`, `RH`, and `wind`. Our model has a r-squared value of 0.66, inidcating that our model would likely be moderately useful in predicting the initial rate of spread of a fire.   
 

## Brief Summary 
``` {r read_data}
# Lets get a brief summary of our dataset
```


Footnotes: 

[^1]: http://cwfis.cfs.nrcan.gc.ca/background/summary/fwi <br>
[^2]: http://cwfis.cfs.nrcan.gc.ca/background/summary/fwi <br>
[^3]: https://www.iafss.org/publications/aofst/1/77/view/aofst_1-77.pdf <br>
[^4]: https://cfs.nrcan.gc.ca/publications/download-pdf/28538 <br>
[^5]: https://www.bbc.com/news/world-europe-45070498 <br>




